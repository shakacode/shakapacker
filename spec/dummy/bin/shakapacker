#!/usr/bin/env ruby

ENV["RAILS_ENV"] ||= "development"
ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../Gemfile", __dir__)
ENV["APP_ROOT"] ||= File.expand_path("..", __dir__)

# Auto-setup: If shakapacker.yml doesn't exist, use webpack config as default
config_dir = File.expand_path("../config", __dir__)
shakapacker_config = File.join(config_dir, "shakapacker.yml")
webpack_config = File.join(config_dir, "shakapacker-webpack.yml")

unless File.exist?(shakapacker_config)
  if File.exist?(webpack_config)
    require "fileutils"
    FileUtils.cp(webpack_config, shakapacker_config)
    puts "ðŸ“¦ Auto-configured with webpack (copied shakapacker-webpack.yml â†’ shakapacker.yml)"
    puts "ðŸ’¡ To switch bundlers, use: bin/test-bundler [webpack|rspack]"
    puts ""
  end
end

require "bundler/setup"
require "shakapacker"
require "shakapacker/runner"

Shakapacker::Runner.run(ARGV)

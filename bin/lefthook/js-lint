#!/usr/bin/env bash
# Lint and format staged JavaScript/TypeScript files

if [ -z "$1" ]; then
  echo "No files to check"
  exit 0
fi

echo "Running JavaScript/TypeScript linter and formatter on staged files..."

# Collect all JS/TS files for ESLint and Prettier
js_ts_files=""

for file in "$@"; do
  if [[ "$file" == *.ts || "$file" == *.tsx || "$file" == *.js || "$file" == *.jsx ]]; then
    js_ts_files="$js_ts_files $file"
  fi
done

has_errors=0

# Run ESLint with --fix on JS/TS files
if [ -n "$js_ts_files" ]; then
  echo "Running ESLint --fix..."
  yarn eslint --fix $js_ts_files || has_errors=1
fi

# Run Prettier on JS/TS files
if [ -n "$js_ts_files" ]; then
  echo "Running Prettier..."
  yarn prettier --write $js_ts_files || has_errors=1
fi

if [ $has_errors -ne 0 ]; then
  echo ""
  echo "JavaScript/TypeScript linting or formatting failed."
  echo "Please review the changes and stage them if they look good:"
  echo "  git add <files>"
  exit 1
fi

echo "âœ“ JavaScript/TypeScript linting and formatting passed"
